pipeline{
    agent any
    environment{
        PATH="/opt/maven/bin/:$PATH"
        DOCKERHUB_CREDENTIALS = credentials("Docker-Credentials")
    }
    stages{
        stage("docker login"){
            sh "echo $DOCKERHUB_CREDENTIALS_PSW | docker login -u $DOCKERHUB_CREDENTIALS_USR --password-stdin"
        }
        stage("Docker build"){
            steps{
                sh "docker build -t myApp:latest ."
            }
        }
        stage("Docker tag"){
            steps{
                sh "docker tag myApp:latest zerotwo0938/capstone_react"
            }
        }
        stage("Docker push"){
            steps{
                sh "docker push zerotwo0938/capstone_react"
            }
        }
        stage("Deploy"){
            steps{
                script{
                    KubernetesDeploy(configs: "deployment.yaml")
                }
        }
        stage("Show port"){
            print "Port of react app:"
            sh "kubectl get svc"
        }
}
